<div #contextMenu class="context-menu">
    <div class="context-item" (click)="editContextMenuSelection()">Bearbeiten</div>
    <div class="context-item" (click)="deleteContextMenuSelection()">Löschen</div>
</div>
<div class="pb-4">
    <div class="shift-card" style="padding-top: 0px;" >
        <button class="btn" (click)="changeEditMode()">{{editMode ? 'Ansichts Modus' :
            'Bearbeiten'}}</button>
        <button class="btn-secondary" (click)="pickAddUser()"
            *ngIf="editMode">{{currentAddUser ?
                currentAddUser.get('firstName') + ' ' + currentAddUser.get('lastName') : 'Schicht hinzufügen'}}</button>
        <button class="btn-secondary"  (click)="toggleIncludeWishes()">{{includeWishesInTable ?
                'Wünschschichten ausblenden' : 'Wünschschichten anzeigen'}}</button>
    </div>
</div>
<div class="table-container no-select">
    <table class="relative" (contextmenu)="onContextMenu($event)">
        <thead>
            <tr>
                <th>Kategorien</th>
                <ng-container *ngFor="let timeSlot of shiftTable?.headerTimeSlots ?? []; let i = index">

                    <th>
                        <div [style]="'width: ' + shiftTableService.widthInterval + 'px;'">
                            {{timeSlot.start | fromTo: timeSlot.end}}
                        </div>
                        <div class="absolute top-0 h-full border-l border-dotted text-white">
                            .
                        </div>
                    </th>
                </ng-container>
            </tr>
        </thead>
        <tbody>
            <ng-container *ngFor="let tableCategory of shiftTable?.categories ?? []; let iCategory = index">
                <tr>
                    <td class="bg-white z-20">{{tableCategory.category.get('name')}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td colspan="100%" (click)="onTableClick(tableCategory.category, $event)">
                        <ng-container *ngFor="let tableShift of tableCategory.shifts; let iTableShift = index">
                            <div [style]="'margin-left: ' + tableShift.marginLeftPx + 'px; width: ' + tableShift.widthPx + 'px'"
                                [class]="(editMode ? 'table-shift-item-edit' : '') + ' rounded px-2 bg-orange-300 text-gray-700'"
                                (mousedown)="onShiftMouseDown($event, tableShift)"
                                [id]="tableShiftIdPrefix + iCategory + ':' + iTableShift">
                                {{tableShift.shift.get('user').get('firstName')}}
                                {{tableShift.shift.get('user').get('lastName')}}
                            </div>
                        </ng-container>
                        <span *ngIf="tableCategory.shifts?.length === 0" class="text-white">.</span>
                    </td>
                </tr>
                <tr *ngIf="(tableCategory.userWishs ?? []).length > 1">
                    <td></td>
                    <td colspan="100%">
                        <ng-container *ngFor="let tableShift of tableCategory.userWishs">
                            <div [style]="'margin-left: ' + tableShift.marginLeftPx + 'px; width: ' + tableShift.widthPx + 'px'"
                                class="rounded px-2 bg-gray-300 text-gray-700">
                                {{tableShift.shift.get('user').get('firstName')}}
                                {{tableShift.shift.get('user').get('lastName')}}
                            </div>
                        </ng-container>
                        <span *ngIf="tableCategory.userWishs?.length === 0" class="text-white">.</span>
                    </td>
                </tr>
            </ng-container>
        </tbody>
    </table>
</div>